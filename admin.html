<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - Digital Menu</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <!-- jsPDF for PDF export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <!-- SheetJS for Excel export -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <!-- docx for Word export -->
  <script src="https://unpkg.com/docx@8.2.3/build/index.js"></script>
  <style>
    body {
      background: #f8f9fa;
      padding-top: 70px;
    }
    .admin-card {
      background: white;
      border-radius: 10px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }
    .stats-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
    }
    .nav-pills .nav-link.active {
      background-color: #667eea;
    }
    .table-responsive {
      border-radius: 10px;
      overflow: hidden;
    }
    .btn-action {
      margin: 2px;
    }
    .export-dropdown {
      min-width: 200px;
    }
    .export-option {
      padding: 8px 16px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    .export-option:hover {
      background-color: #f8f9fa;
    }
    .export-option i {
      width: 20px;
      margin-right: 8px;
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
    <div class="container-fluid">
      <a class="navbar-brand" href="index.html">
        <i class="fas fa-cog me-2"></i>Admin Panel
      </a>
      <div class="d-flex">
        <a href="index.html" class="btn btn-outline-light btn-sm me-2">
          <i class="fas fa-home me-1"></i>Home
        </a>
        <a href="kitchen.html" class="btn btn-outline-light btn-sm me-2">
          <i class="fas fa-utensils me-1"></i>Kitchen
        </a>
        <div class="dropdown">
          <button class="btn btn-outline-warning btn-sm dropdown-toggle" type="button" id="exportDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="fas fa-download me-1"></i>Export
          </button>
          <ul class="dropdown-menu export-dropdown" aria-labelledby="exportDropdown">
            <li><div class="export-option" onclick="exportData('json')"><i class="fas fa-file-code text-primary"></i>JSON Format</div></li>
            <li><div class="export-option" onclick="exportData('pdf')"><i class="fas fa-file-pdf text-danger"></i>PDF Format</div></li>
            <li><div class="export-option" onclick="exportData('excel')"><i class="fas fa-file-excel text-success"></i>Excel Format</div></li>
            <li><div class="export-option" onclick="exportData('word')"><i class="fas fa-file-word text-primary"></i>Word Format</div></li>
          </ul>
        </div>
      </div>
    </div>
  </nav>

  <div class="container-fluid">
    <!-- Statistics Row -->
    <div class="row mb-4">
      <div class="col-md-3">
        <div class="stats-card">
          <div class="d-flex justify-content-between">
            <div>
              <h3 id="totalOrders">0</h3>
              <p class="mb-0">Total Orders</p>
            </div>
            <i class="fas fa-shopping-cart fa-2x"></i>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
          <div class="d-flex justify-content-between">
            <div>
              <h3 id="totalRevenue">â‚¹0</h3>
              <p class="mb-0">Total Revenue</p>
            </div>
            <i class="fas fa-rupee-sign fa-2x"></i>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
          <div class="d-flex justify-content-between">
            <div>
              <h3 id="totalDishes">0</h3>
              <p class="mb-0">Total Dishes</p>
            </div>
            <i class="fas fa-utensils fa-2x"></i>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="stats-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
          <div class="d-flex justify-content-between">
            <div>
              <h3 id="totalFavorites">0</h3>
              <p class="mb-0">Favorites</p>
            </div>
            <i class="fas fa-heart fa-2x"></i>
          </div>
        </div>
      </div>
    </div>

    <!-- Main Content -->
    <div class="row">
      <div class="col-md-3">
        <div class="admin-card p-3">
          <h5><i class="fas fa-bars me-2"></i>Navigation</h5>
          <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist">
            <button class="nav-link active" data-bs-toggle="pill" data-bs-target="#orders-tab">
              <i class="fas fa-shopping-cart me-2"></i>Orders
            </button>
            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#dishes-tab">
              <i class="fas fa-utensils me-2"></i>Dishes
            </button>
            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#categories-tab">
              <i class="fas fa-tags me-2"></i>Categories
            </button>
            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#favorites-tab">
              <i class="fas fa-heart me-2"></i>Favorites
            </button>
            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#settings-tab">
              <i class="fas fa-cog me-2"></i>Settings
            </button>
            <button class="nav-link" data-bs-toggle="pill" data-bs-target="#analytics-tab">
              <i class="fas fa-chart-bar me-2"></i>Analytics
            </button>
          </div>
        </div>
      </div>

      <div class="col-md-9">
        <div class="tab-content" id="v-pills-tabContent">
          <!-- Orders Tab -->
          <div class="tab-pane fade show active" id="orders-tab">
            <div class="admin-card p-3">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5><i class="fas fa-shopping-cart me-2"></i>Order Management</h5>
                <div>
                  <button class="btn btn-success btn-sm" onclick="addNewOrder()">
                    <i class="fas fa-plus me-1"></i>Add Order
                  </button>
                  <button class="btn btn-danger btn-sm" onclick="clearAllOrders()">
                    <i class="fas fa-trash me-1"></i>Clear All
                  </button>
                </div>
              </div>
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>S.No</th>
                      <th>Customer</th>
                      <th>Table</th>
                      <th>Items</th>
                      <th>Total</th>
                      <th>Status</th>
                      <th>Date</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="ordersTableBody">
                    <!-- Populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Dishes Tab -->
          <div class="tab-pane fade" id="dishes-tab">
            <div class="admin-card p-3">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5><i class="fas fa-utensils me-2"></i>Dish Management</h5>
                <button class="btn btn-success btn-sm" onclick="addNewDish()">
                  <i class="fas fa-plus me-1"></i>Add Dish
                </button>
              </div>
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>S.No</th>
                      <th>Name</th>
                      <th>Category</th>
                      <th>Price</th>
                      <th>Image</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="dishesTableBody">
                    <!-- Populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Categories Tab -->
          <div class="tab-pane fade" id="categories-tab">
            <div class="admin-card p-3">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5><i class="fas fa-tags me-2"></i>Category Management</h5>
                <button class="btn btn-success btn-sm" onclick="addNewCategory()">
                  <i class="fas fa-plus me-1"></i>Add Category
                </button>
              </div>
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>Category Name</th>
                      <th>Dish Count</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="categoriesTableBody">
                    <!-- Populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Favorites Tab -->
          <div class="tab-pane fade" id="favorites-tab">
            <div class="admin-card p-3">
              <div class="d-flex justify-content-between align-items-center mb-3">
                <h5><i class="fas fa-heart me-2"></i>Favorites Management</h5>
                <button class="btn btn-danger btn-sm" onclick="clearAllFavorites()">
                  <i class="fas fa-trash me-1"></i>Clear All
                </button>
              </div>
              <div class="table-responsive">
                <table class="table table-hover">
                  <thead class="table-dark">
                    <tr>
                      <th>Dish Name</th>
                      <th>Category</th>
                      <th>Price</th>
                      <th>Date Added</th>
                      <th>Actions</th>
                    </tr>
                  </thead>
                  <tbody id="favoritesTableBody">
                    <!-- Populated by JavaScript -->
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- Settings Tab -->
          <div class="tab-pane fade" id="settings-tab">
            <div class="admin-card p-3">
              <h5><i class="fas fa-cog me-2"></i>System Settings</h5>
              <div class="row">
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Theme</label>
                    <select class="form-select" id="themeSetting">
                      <option value="light">Light</option>
                      <option value="dark">Dark</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <label class="form-label">Currency</label>
                    <input type="text" class="form-control" id="currencySetting" value="â‚¹">
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="mb-3">
                    <label class="form-label">Language</label>
                    <select class="form-select" id="languageSetting">
                      <option value="en">English</option>
                      <option value="hi">Hindi</option>
                    </select>
                  </div>
                  <div class="mb-3">
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="notificationsSetting">
                      <label class="form-check-label">Enable Notifications</label>
                    </div>
                  </div>
                </div>
              </div>
              <button class="btn btn-primary" onclick="saveSettings()">
                <i class="fas fa-save me-1"></i>Save Settings
              </button>
            </div>
          </div>

          <!-- Analytics Tab -->
          <div class="tab-pane fade" id="analytics-tab">
            <div class="admin-card p-3">
              <h5><i class="fas fa-chart-bar me-2"></i>Analytics & Reports</h5>
              <div class="row">
                <div class="col-md-6">
                  <h6>Popular Dishes</h6>
                  <div id="popularDishesList">
                    <!-- Populated by JavaScript -->
                  </div>
                </div>
                <div class="col-md-6">
                  <h6>Revenue by Date (Last 7 days)</h6>
                  <div id="revenueChart">
                    <!-- Populated by JavaScript -->
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <!-- LocalStorage Service -->
  <script src="localStorageService.js"></script>
  
  <script>
    // Initialize admin panel
    document.addEventListener('DOMContentLoaded', () => {
      loadStatistics();
      loadOrders();
      loadDishes();
      loadCategories();
      loadFavorites();
      loadSettings();
      loadAnalytics();
    });

    // Load and display statistics
    function loadStatistics() {
      const stats = localStorageService.getOrderStatistics();
      document.getElementById('totalOrders').textContent = stats.totalOrders;
      document.getElementById('totalRevenue').textContent = `â‚¹${stats.totalRevenue}`;
      document.getElementById('totalDishes').textContent = localStorageService.getAllDishes().length;
      document.getElementById('totalFavorites').textContent = localStorageService.getAllFavorites().length;
    }

    // Load and display orders
    function loadOrders() {
      const orders = localStorageService.getAllOrders();
      const tbody = document.getElementById('ordersTableBody');
      tbody.innerHTML = '';

      orders.forEach((order, index) => {
        const total = order.cart ? order.cart.reduce((sum, item) => sum + (item.qty * item.price), 0) : 0;
        const items = order.cart ? order.cart.map(i => `${i.name}Ã—${i.qty}`).join(', ') : 'No items';
        const status = order.completed ? 'Completed' : (order.status || 'Pending');
        const statusClass = order.completed ? 'badge-success' : 'badge-warning';

        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${order.customer || 'Anonymous'}</td>
          <td>${order.table || 'Takeaway'}</td>
          <td>${items}</td>
          <td>â‚¹${total}</td>
          <td><span class="badge ${statusClass}">${status}</span></td>
          <td>${order.time || order.createdAt || 'Unknown'}</td>
          <td>
            <button class="btn btn-sm btn-primary btn-action" onclick="editOrder(${order.id || index})">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-danger btn-action" onclick="deleteOrder(${order.id || index})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Load and display dishes
    function loadDishes() {
      const dishes = localStorageService.getAllDishes();
      const tbody = document.getElementById('dishesTableBody');
      tbody.innerHTML = '';

      dishes.forEach((dish, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${index + 1}</td>
          <td>${dish.name}</td>
          <td>${dish.category}</td>
          <td>â‚¹${dish.price}</td>
          <td><img src="${dish.img}" alt="${dish.name}" style="width: 50px; height: 50px; object-fit: cover;"></td>
          <td>
            <button class="btn btn-sm btn-primary btn-action" onclick="editDish(${dish.id || index})">
              <i class="fas fa-edit"></i>
            </button>
            <button class="btn btn-sm btn-danger btn-action" onclick="deleteDish(${dish.id || index})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Load and display categories
    function loadCategories() {
      const categories = localStorageService.getAllCategories();
      const dishes = localStorageService.getAllDishes();
      const tbody = document.getElementById('categoriesTableBody');
      tbody.innerHTML = '';

      categories.forEach(category => {
        const dishCount = dishes.filter(dish => dish.category === category).length;
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${category}</td>
          <td>${dishCount}</td>
          <td>
            <button class="btn btn-sm btn-danger btn-action" onclick="deleteCategory('${category}')">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Load and display favorites
    function loadFavorites() {
      const favorites = localStorageService.getAllFavorites();
      const tbody = document.getElementById('favoritesTableBody');
      tbody.innerHTML = '';

      favorites.forEach(favorite => {
        const dateAdded = favorite.dateAdded ? new Date(favorite.dateAdded).toLocaleDateString() : 'Unknown';
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${favorite.name}</td>
          <td>${favorite.category}</td>
          <td>â‚¹${favorite.price}</td>
          <td>${dateAdded}</td>
          <td>
            <button class="btn btn-sm btn-danger btn-action" onclick="removeFavorite(${favorite.id})">
              <i class="fas fa-trash"></i>
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    // Load and display settings
    function loadSettings() {
      const settings = localStorageService.getSettings();
      document.getElementById('themeSetting').value = settings.theme || 'light';
      document.getElementById('currencySetting').value = settings.currency || 'â‚¹';
      document.getElementById('languageSetting').value = settings.language || 'en';
      document.getElementById('notificationsSetting').checked = settings.notifications !== false;
    }

    // Load and display analytics
    function loadAnalytics() {
      // Popular dishes
      const popularDishes = localStorageService.getPopularDishes(5);
      const popularList = document.getElementById('popularDishesList');
      popularList.innerHTML = '<ul class="list-group">';
      popularDishes.forEach(dish => {
        popularList.innerHTML += `
          <li class="list-group-item d-flex justify-content-between align-items-center">
            ${dish.name}
            <span class="badge bg-primary rounded-pill">${dish.count}</span>
          </li>
        `;
      });
      popularList.innerHTML += '</ul>';

      // Revenue chart
      const revenueData = localStorageService.getRevenueByDate(7);
      const revenueChart = document.getElementById('revenueChart');
      revenueChart.innerHTML = '<ul class="list-group">';
      Object.entries(revenueData).forEach(([date, revenue]) => {
        revenueChart.innerHTML += `
          <li class="list-group-item d-flex justify-content-between align-items-center">
            ${date}
            <span class="badge bg-success rounded-pill">â‚¹${revenue}</span>
          </li>
        `;
      });
      revenueChart.innerHTML += '</ul>';
    }

    // Action functions
    function addNewOrder() {
      alert('Add new order functionality would go here');
    }

    function editOrder(orderId) {
      alert(`Edit order ${orderId} functionality would go here`);
    }

    function deleteOrder(orderId) {
      if (confirm('Are you sure you want to delete this order?')) {
        localStorageService.deleteOrder(orderId);
        loadOrders();
        loadStatistics();
      }
    }

    function clearAllOrders() {
      if (confirm('Are you sure you want to clear all orders? This cannot be undone!')) {
        localStorageService.clearAllData();
        loadOrders();
        loadStatistics();
      }
    }

    function addNewDish() {
      alert('Add new dish functionality would go here');
    }

    function editDish(dishId) {
      alert(`Edit dish ${dishId} functionality would go here`);
    }

    function deleteDish(dishId) {
      if (confirm('Are you sure you want to delete this dish?')) {
        localStorageService.deleteDish(dishId);
        loadDishes();
        loadStatistics();
      }
    }

    function addNewCategory() {
      const categoryName = prompt('Enter new category name:');
      if (categoryName) {
        localStorageService.addCategory(categoryName);
        loadCategories();
      }
    }

    function deleteCategory(categoryName) {
      if (confirm(`Are you sure you want to delete category "${categoryName}"?`)) {
        localStorageService.deleteCategory(categoryName);
        loadCategories();
      }
    }

    function removeFavorite(dishId) {
      if (confirm('Are you sure you want to remove this from favorites?')) {
        localStorageService.removeFromFavorites(dishId);
        loadFavorites();
        loadStatistics();
      }
    }

    function clearAllFavorites() {
      if (confirm('Are you sure you want to clear all favorites?')) {
        const favorites = localStorageService.getAllFavorites();
        favorites.forEach(favorite => {
          localStorageService.removeFromFavorites(favorite.id);
        });
        loadFavorites();
        loadStatistics();
      }
    }

    function saveSettings() {
      const settings = {
        theme: document.getElementById('themeSetting').value,
        currency: document.getElementById('currencySetting').value,
        language: document.getElementById('languageSetting').value,
        notifications: document.getElementById('notificationsSetting').checked
      };
      localStorageService.updateSettings(settings);
      alert('Settings saved successfully!');
    }

    function exportData(format) {
      const data = localStorageService.exportData();
      const timestamp = new Date().toISOString().split('T')[0];

      try {
        if (format === 'json') {
          // JSON Export
          const dataStr = JSON.stringify(data, null, 2);
          const blob = new Blob([dataStr], {type: 'application/json'});
          downloadFile(blob, `digital-menu-backup-${timestamp}.json`);
          
        } else if (format === 'pdf') {
          // PDF Export
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF();
          
          // Add title
          doc.setFontSize(20);
          doc.text('Digital Menu Backup Report', 20, 20);
          
          // Add date
          doc.setFontSize(12);
          doc.text(`Generated on: ${new Date().toLocaleDateString()}`, 20, 35);
          
          // Add data sections
          let yPosition = 50;
          doc.setFontSize(14);
          doc.text('Orders:', 20, yPosition);
          yPosition += 10;
          
          if (data.orders && data.orders.length > 0) {
            data.orders.forEach((order, index) => {
              if (yPosition > 250) {
                doc.addPage();
                yPosition = 20;
              }
              doc.setFontSize(10);
              doc.text(`Order ${index + 1}: ${order.customer || 'Anonymous'} - â‚¹${order.total || 0}`, 25, yPosition);
              yPosition += 5;
            });
          }
          
          yPosition += 10;
          doc.setFontSize(14);
          doc.text('Dishes:', 20, yPosition);
          yPosition += 10;
          
          if (data.dishes && data.dishes.length > 0) {
            data.dishes.forEach((dish, index) => {
              if (yPosition > 250) {
                doc.addPage();
                yPosition = 20;
              }
              doc.setFontSize(10);
              doc.text(`${dish.name} - ${dish.category} - â‚¹${dish.price}`, 25, yPosition);
              yPosition += 5;
            });
          }
          
          const blob = doc.output('blob');
          downloadFile(blob, `digital-menu-backup-${timestamp}.pdf`);
          
        } else if (format === 'excel') {
          // Excel Export
          const workbook = XLSX.utils.book_new();
          
          // Orders sheet
          if (data.orders && data.orders.length > 0) {
            const ordersData = data.orders.map(order => ({
              'Order ID': order.id,
              'Customer': order.customer || 'Anonymous',
              'Table': order.table || 'Takeaway',
              'Total': order.total || 0,
              'Status': order.completed ? 'Completed' : 'Pending',
              'Date': order.time || order.createdAt || 'Unknown'
            }));
            const ordersSheet = XLSX.utils.json_to_sheet(ordersData);
            XLSX.utils.book_append_sheet(workbook, ordersSheet, 'Orders');
          }
          
          // Dishes sheet
          if (data.dishes && data.dishes.length > 0) {
            const dishesData = data.dishes.map(dish => ({
              'Dish ID': dish.id,
              'Name': dish.name,
              'Category': dish.category,
              'Price': dish.price,
              'Description': dish.description || ''
            }));
            const dishesSheet = XLSX.utils.json_to_sheet(dishesData);
            XLSX.utils.book_append_sheet(workbook, dishesSheet, 'Dishes');
          }
          
          // Categories sheet
          if (data.categories && data.categories.length > 0) {
            const categoriesData = data.categories.map(category => ({
              'Category': category
            }));
            const categoriesSheet = XLSX.utils.json_to_sheet(categoriesData);
            XLSX.utils.book_append_sheet(workbook, categoriesSheet, 'Categories');
          }
          
          XLSX.writeFile(workbook, `digital-menu-backup-${timestamp}.xlsx`);
          
        } else if (format === 'word') {
          // Word Export
          const { Document, Packer, Paragraph, TextRun } = window.docx;
          
          const doc = new Document({
            sections: [{
              properties: {},
              children: [
                new Paragraph({
                  children: [
                    new TextRun({
                      text: "Digital Menu Backup Report",
                      bold: true,
                      size: 32
                    })
                  ]
                }),
                new Paragraph({
                  children: [
                    new TextRun({
                      text: `Generated on: ${new Date().toLocaleDateString()}`,
                      size: 20
                    })
                  ]
                }),
                new Paragraph({
                  children: [new TextRun({ text: "" })]
                }),
                new Paragraph({
                  children: [
                    new TextRun({
                      text: "Orders:",
                      bold: true,
                      size: 24
                    })
                  ]
                })
              ]
            }]
          });
          
          // Add orders data
          if (data.orders && data.orders.length > 0) {
            data.orders.forEach(order => {
              doc.addSection({
                children: [
                  new Paragraph({
                    children: [
                      new TextRun({
                        text: `Order ${order.id}: ${order.customer || 'Anonymous'} - â‚¹${order.total || 0}`,
                        size: 16
                      })
                    ]
                  })
                ]
              });
            });
          }
          
          // Add dishes data
          doc.addSection({
            children: [
              new Paragraph({
                children: [
                  new TextRun({
                    text: "Dishes:",
                    bold: true,
                    size: 24
                  })
                ]
              })
            ]
          });
          
          if (data.dishes && data.dishes.length > 0) {
            data.dishes.forEach(dish => {
              doc.addSection({
                children: [
                  new Paragraph({
                    children: [
                      new TextRun({
                        text: `${dish.name} - ${dish.category} - â‚¹${dish.price}`,
                        size: 16
                      })
                    ]
                  })
                ]
              });
            });
          }
          
          // Generate and download
          Packer.toBlob(doc).then(blob => {
            downloadFile(blob, `digital-menu-backup-${timestamp}.docx`);
          });
          
        }
        
        alert(`Data exported successfully in ${format.toUpperCase()} format!`);
        
      } catch (error) {
        console.error('Export error:', error);
        alert(`Error exporting data in ${format.toUpperCase()} format: ${error.message}`);
      }
    }

    // Helper function to download files
    function downloadFile(blob, filename) {
      const url = URL.createObjectURL(blob);
      const link = document.createElement('a');
      link.href = url;
      link.download = filename;
      link.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
